<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hindustan Rubber Report</title>
    <style>
        :root { 
            --primary: #1a73e8; 
            --secondary: #34a853; 
            --bg: #f0f4f8; 
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #999;
            --input-bg: #ffffff;
            --danger: #d93025;
            --header-bg: #e8f0fe;
        }

        body.dark-mode {
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #555;
            --input-bg: #2c2c2c;
            --header-bg: #3c4043;
            --primary: #4285f4;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg); color: var(--text-color); padding: 12px; margin: 0; padding-bottom: 80px; }
        
        .card { 
            background: var(--card-bg); 
            padding: 15px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            margin-bottom: 15px;
            border-top: 4px solid var(--primary);
        }

        h3 { margin-top: 0; color: var(--primary); font-size: 18px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }

        /* --- INPUT GRID --- */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-bottom: 12px;
        }
        
        label { display: block; font-size: 11px; font-weight: bold; margin-bottom: 4px; opacity: 0.8; text-transform: uppercase; }
        
        input { 
            width: 100%; padding: 10px; 
            border: 1px solid var(--border-color); 
            border-radius: 4px; 
            background: var(--input-bg); 
            color: var(--text-color);
            box-sizing: border-box; 
            font-size: 15px;
            font-weight: 500;
        }
        input:focus { border-color: var(--primary); outline: none; border-width: 2px; padding: 9px; }

        /* BUTTONS */
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; font-size: 14px; }
        .btn-add { background: var(--primary); }
        .btn-clear { background: var(--danger); }
        .btn-print { background: var(--secondary); margin-bottom: 10px; width: 100%; }

        /* --- REPORT LAYOUT (Screen) --- */
        .print-only-block { display: none; }
        .lbl-print { display: none; } 
        .print-total-row { display: none; }
        
        .table-wrap { overflow-x: auto; border: 1px solid #000; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 100%; }
        
        thead { background: var(--header-bg); }
        
        /* SCREEN Borders */
        th, td { 
            border-right: 1px solid #000;
            border-bottom: 1px solid #000;
            padding: 8px 5px;
            vertical-align: middle;
            text-align: center; 
        }
        th:last-child, td:last-child { border-right: none; }

        th { font-weight: bold; color: #000; white-space: nowrap; }
        .sub-head { display: block; font-size: 11px; font-weight: normal; margin-top: 2px; }

        .col-right { text-align: right; }
        .val-row { margin-bottom: 4px; }
        .total-row td { background: #eee; font-weight: bold; color: #000; border-top: 2px solid #000; }
        .grand-total { font-size: 16px; }

        .sl-cell { cursor: pointer; text-decoration: underline; color: var(--primary); }
        .sl-cell:hover { background: #ffeb3b; }

        /* --- PRINT STYLES (PDF) --- */
        @media print {
            body { background: white; padding: 0; margin: 0; color: #000000 !important; }
            #inputCard { display: none !important; } 
            .btn-print { display: none !important; }
            .card { box-shadow: none; border: none; padding: 0; margin: 0; }
            
            /* SHOW/HIDE ELEMENTS */
            .print-only-block { display: block; }
            .lbl-print { display: inline; }
            .lbl-screen { display: none; }
            .print-total-row { display: block; }
            
            /* SHOW NOTE BUT HIDE DELETE HINT */
            #screenNote { display: block !important; border-top: none !important; margin-top: 5px; }
            #deleteHint { display: none !important; }

            /* --- BORDER FIXES: UNIFORM THICKNESS --- */
            .table-wrap { border: none !important; }
            
            table { 
                border-collapse: collapse; 
                width: 100%; 
                border: 2px solid #000000 !important; /* Outer Border */
            }
            th, td { 
                border: 2px solid #000000 !important; /* Inner Borders */
            }

            /* --- TEXT SIZE & COLOR FIXES --- */
            * { color: #000000 !important; }

            /* Uniform Font Size for Headers and Data */
            table, th, td, .val-row, .print-total-row, .grand-total { 
                font-size: 18px !important; 
            }
            
            /* Header Spacing */
            th { padding: 10px 5px !important; }
            
            /* Sub-header (Base | Top) styling */
            .sub-head { 
                font-size: 18px !important; 
                font-weight: bold !important; 
                display: block;
                margin-top: 4px;
            }

            /* Report Header */
            .report-company { text-align: center; font-size: 26px; font-weight: bold; text-decoration: underline; margin-bottom: 25px; text-transform: uppercase; color: #000; }
            .report-header-grid { display: grid; grid-template-columns: 1fr 1fr; font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #000; }
            .header-right { text-align: right; }

            /* Bold Values */
            .val-row, .total-line { font-weight: bold; }
            
            /* Total Wt Line - Uniform Size */
            .print-total-row {
                border-top: 2px solid #000;
                margin-top: 6px;
                padding-top: 4px;
                font-weight: bold !important; 
            }
            
            /* Remove Link Styling & MAKE BOLD for Sl. No */
            .sl-cell { 
                text-decoration: none; 
                color: #000; 
                cursor: default; 
                font-weight: bold !important; /* FIXED: Now Bold */
            }
        }

    </style>
</head>
<body>

<div class="container">
    
    <div class="card" id="inputCard">
        <h3>Batch Cost Entry</h3>
        
        <div class="form-grid">
            <div>
                <label>Roll Name</label>
                <input type="text" id="rollName" placeholder="e.g. NBR Jumbo" onkeyup="updateHeaderInfo()">
            </div>
            <div>
                <label>G.P. No.</label>
                <input type="text" id="gpNo" placeholder="101" onkeyup="updateHeaderInfo()">
            </div>

            <div>
                <label>Supply Date</label>
                <input type="date" id="supplyDate" onchange="updateHeaderInfo()">
            </div>
            <div>
                <label>Total Qty</label>
                <input type="number" id="totalQty" placeholder="e.g. 2" oninput="checkLimit()">
            </div>

            <div>
                <label>Sl. No.</label>
                <input type="number" id="slNo" value="1">
            </div>
            <div>
                <label>Roll ID.</label>
                <input type="text" id="rollId" placeholder="ID-001">
            </div>

            <div>
                <label>Base Weight (Kg)</label>
                <input type="number" step="0.01" id="baseWt" placeholder="0.00">
            </div>
            <div>
                <label>Base Rate ()</label>
                <input type="number" step="0.01" id="baseRate" placeholder="0.00" oninput="updateRateNote()">
            </div>

            <div>
                <label>Top Weight (Kg)</label>
                <input type="number" step="0.01" id="topWt" placeholder="0.00">
            </div>
            <div>
                <label>Top Rate ()</label>
                <input type="number" step="0.01" id="topRate" placeholder="0.00" oninput="updateRateNote()">
            </div>
        </div>

        <div class="btn-row">
            <button class="btn-add" onclick="addEntry()">ADD ENTRY</button>
            <button class="btn-clear" onclick="clearAllData()">CLEAR ALL</button>
        </div>
    </div>

    <div class="card" id="reportCard">
        <button class="btn-print" onclick="window.print()"> Print Report Only</button>
        
        <div class="print-only-block">
            <div class="report-company">Hindustan Rubber Products</div>
            
            <div class="report-header-grid">
                <div>Roll Name: <span id="repRollName"></span></div>
                <div class="header-right">GP No: <span id="repGp"></span></div>
            </div>
            
            <div class="report-header-grid">
                <div>Supply Date: <span id="repDate"></span></div>
                <div class="header-right">Total Qty: <span id="repQty"></span></div>
            </div>
        </div>
        
        <div class="table-wrap">
            <table id="reportTable">
                <thead>
                    <tr>
                        <th style="width:60px">Sl. No.</th>
                        <th>Roll ID</th>
                        <th>Material Wt<br><span class="sub-head">Base | Top</span></th>
                        <th>Amount ()<br><span class="sub-head">Base | Top</span></th>
                        <th style="width:130px">Total<br><span class="sub-head">Amount ()</span></th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="4" class="col-right">Grand Total:</td>
                        <td class="col-right grand-total"><span id="grandTotal">0.00</span></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <p style="font-size:11px; color:#555; margin-top:10px; border-top:1px dashed #ccc; padding-top:5px;" id="screenNote">
            <b>* Note:</b> <span id="rateNote">Enter rates above.</span> 
            <span id="deleteHint" style="color:red">(Click Sl. No. to Delete)</span>
        </p>
    </div>
</div>

<script>
    let entries = [];

    window.onload = function() {
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('supplyDate').value = today;
        updateRateNote();
        updateHeaderInfo();
    };

    function addEntry() {
        const sl = parseInt(document.getElementById('slNo').value) || 0;
        const rId = document.getElementById('rollId').value.trim() || "-";
        const bWt = parseFloat(document.getElementById('baseWt').value) || 0;
        const bRate = parseFloat(document.getElementById('baseRate').value) || 0;
        const tWt = parseFloat(document.getElementById('topWt').value) || 0;
        const tRate = parseFloat(document.getElementById('topRate').value) || 0;
        const maxQty = parseInt(document.getElementById('totalQty').value) || 0;

        if (sl === 0) { alert("Sl No cannot be 0"); return; }
        if (bWt === 0 && tWt === 0) { alert("Please enter weight"); return; }
        
        const isUpdate = entries.some(e => e.sl === sl);
        if (!isUpdate && maxQty > 0 && entries.length >= maxQty) {
            alert(` Limit Reached! Total Qty is ${maxQty}.`);
            return;
        }

        const existingIndex = entries.findIndex(e => e.sl === sl);
        if (existingIndex > -1) {
            if(!confirm(`Sl No ${sl} already exists. Overwrite?`)) return;
            entries.splice(existingIndex, 1);
        }

        const bAmt = bWt * bRate;
        const tAmt = tWt * tRate;
        const totalWt = parseFloat((bWt + tWt).toFixed(2));

        entries.push({
            sl: sl,
            id: rId,
            bWt: bWt, tWt: tWt, totalWt: totalWt,
            bAmt: bAmt, tAmt: tAmt,
            total: bAmt + tAmt
        });

        entries.sort((a, b) => a.sl - b.sl);
        renderTable();
        clearEntryInputs(); 
        setNextSlNo();
        updateHeaderInfo();
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        let grandTot = 0;

        entries.forEach(e => {
            grandTot += e.total;
            const tr = document.createElement('tr');
            
            tr.innerHTML = `
                <td class="sl-cell" onclick="deleteEntry(${e.sl})">${e.sl}</td>
                <td style="font-weight:bold">${e.id}</td>
                <td>
                    <div class="val-row">
                        <span class="lbl-screen">B</span><span class="lbl-print">Base</span> - ${e.bWt}
                    </div>
                    <div class="val-row">
                        <span class="lbl-screen">T</span><span class="lbl-print">Top</span> - ${e.tWt}
                    </div>
                    <div class="print-total-row">Total - ${e.totalWt}</div>
                </td>
                <td>
                    <div class="val-row">
                        <span class="lbl-screen">B</span><span class="lbl-print">Base</span> - ${Math.round(e.bAmt)}
                    </div>
                    <div class="val-row">
                        <span class="lbl-screen">T</span><span class="lbl-print">Top</span> - ${Math.round(e.tAmt)}
                    </div>
                </td>
                <td class="col-right" style="font-weight:bold">
                    ${Math.round(e.total)}
                </td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('grandTotal').innerText = grandTot.toLocaleString('en-IN');
    }

    function deleteEntry(slNo) {
        if(confirm(`Delete Entry Sl. No: ${slNo}?`)) {
            entries = entries.filter(e => e.sl !== slNo);
            renderTable();
            clearEntryInputs();
            setNextSlNo(); 
        }
    }

    function setNextSlNo() {
        const maxQty = parseInt(document.getElementById('totalQty').value) || 100;
        let nextSl = 1;
        for (let i = 1; i <= maxQty + 1; i++) {
            if (!entries.some(e => e.sl === i)) {
                nextSl = i;
                break;
            }
        }
        document.getElementById('slNo').value = nextSl;
    }

    function clearEntryInputs() {
        document.getElementById('baseWt').value = "";
        document.getElementById('topWt').value = "";
        document.getElementById('rollId').value = "";
    }

    function clearAllData() {
        if(confirm("Clear ALL data?")) {
            entries = [];
            const inputs = document.querySelectorAll('input');
            inputs.forEach(i => {
                if(i.type !== 'date') i.value = ""; 
            });
            document.getElementById('slNo').value = "1";
            renderTable();
            updateHeaderInfo();
        }
    }

    function checkLimit() {
        updateHeaderInfo();
        setNextSlNo();
    }

    function updateHeaderInfo() {
        const rollName = document.getElementById('rollName').value;
        const gp = document.getElementById('gpNo').value;
        const qty = document.getElementById('totalQty').value;
        
        const rawDate = document.getElementById('supplyDate').value;
        const dateObj = new Date(rawDate);
        const niceDate = !isNaN(dateObj) ? dateObj.toLocaleDateString('en-GB') : "";

        document.getElementById('repRollName').innerText = rollName || "-";
        document.getElementById('repGp').innerText = gp || "-";
        document.getElementById('repQty').innerText = qty || "-";
        document.getElementById('repDate').innerText = niceDate;
    }

    function updateRateNote() {
        const bRate = document.getElementById('baseRate').value || "0";
        const tRate = document.getElementById('topRate').value || "0";
        const note = document.getElementById('rateNote');
        
        if (bRate === "0" && tRate === "0") {
             note.innerText = "Enter Base/Top Rates to see them here.";
        } else {
             note.innerText = `Current Rates: Base @ ${bRate}/kg | Top @ ${tRate}/kg`;
        }
    }
</script>

</body>
</html>

